FROM debian:bullseye-slim

RUN apt-get update && apt-get install -y \
    build-essential cmake git curl wget ca-certificates \
    && rm -rf /var/lib/apt/lists/*

WORKDIR /app

RUN git clone https://github.com/ggerganov/whisper.cpp.git
WORKDIR /app/whisper.cpp

RUN make whisper-server

RUN ./models/download-ggml-model.sh base.en

ENV PORT=8080
EXPOSE ${PORT}

CMD ["sh", "-c", "./build/bin/whisper-server -m models/ggml-base.en.bin -p $PORT"]